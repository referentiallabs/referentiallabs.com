<!doctype html><html lang=en-us><head><title>Socket Statistics on Linux with ss | Referential Labs, LLC</title><meta name=title content="Socket Statistics on Linux with ss | Referential Labs, LLC"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content=True><meta name=MobileOptimized content=320><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=no-referrer-when-downgrade><meta name=generator content><base href=https://referentiallabs.com/><meta name=description content="Learn how to troubleshoot sockets using the ss command on Linux"><meta name=author content="Referential Labs, LLC"><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@referentiallabs><meta name=twitter:creator content=@referentiallabs><meta property=og:title content="Socket Statistics on Linux with ss | Referential Labs, LLC"><meta property=og:type content=website><meta property=og:url content=https://referentiallabs.com/><meta property=og:image content=https://referentiallabs.com//images/logo256.png><meta name=og:description content="Learn how to troubleshoot sockets using the ss command on Linux"><link rel=icon type=image/png sizes=16x16 href=favicon.png><meta name=theme-color content=#FFF><link rel=canonical href=https://referentiallabs.com/blog/2019/04/socket-statistics-linux-ss/><link rel=stylesheet href=https://referentiallabs.com//styles/main.css><style>h1,h2,h3,h4,h5,h6{#color: #5AA60C}h1.name{display:none}.values{background:#efefef}.values .value .value-multiplier{color:#555;text-transform:capitalize}.values .value .value-heading{text-transform:lowercase}ul{list-style:square;padding:0 0 0 2em}nav h3{color:#222}section .content .sub-header{font-size:.9em;color:#5aa60c}dl{display:block}dl dt{display:block;clear:both;float:left;padding:.3em}dl dd{float:right;display:block}#gdpr-description{margin:2px;font-size:.8em;text-align:justified;padding:.8em 0}input[type=email]{border:3px solid #5aa60c}input[type=checkbox]{width:auto;margin:0 .6em}input[type=submit]{background-color:#5aa60c}#gdpr-legal{font-size:.75em;text-align:justified;padding:.7em 0}.gdpr-footer{display:block;margin:.25;border:1px dashed #aaa;text-align:justified;padding:8px;font-size:.7em;padding:.7em 0}.gdpr-footer img{width:auto;float:left;margin:.2em .5em 0 0}footer{background:#444;display:block;clear:both}</style><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-80008235-1','auto');ga('send','pageview');}</script></head><body><nav class="row middle-xs center-xs"><div class="col-xs-6 col-sm-1 logo"><a href=https://referentiallabs.com/#><img src=https://referentiallabs.com/images/logo125.png alt="Referential Labs, LLC"></a></div><div class="col-xs-3 col-sm-2"><h3><a href=https://referentiallabs.com/about>About</a></h3></div><div class="col-xs-3 col-sm-2"><h3><a href=https://referentiallabs.com/blog>Blog</a></h3></div><div class="col-xs-6 col-sm-1 nav-toggle"><a href class=nav-icon onclick="return false"><img src=https://referentiallabs.com/images/icon-menu.png alt="Open Menu"><img src=https://referentiallabs.com/images/icon-x.png alt="Close Menu" style=display:none></a></div></nav><section class="nav-full row middle-xs center-xs"><div class=col-xs-12><div class="row middle-xs center-xs"><div class=col-xs-12><h1><a href=https://referentiallabs.com/about>About</a></h1></div><div class=col-xs-12><h1><a href=https://referentiallabs.com/blog>Blog</a></h1></div></div></div></section><main><section class=container><section class=content><h1>Socket Statistics on Linux with ss</h1><div class=sub-header>April 3, 2019 Â· 3 minute read</div><article class=entry-content><p>An excellent tool when you need to troubleshoot distributed systems is <code>ss</code>, which provides visibility into TCP states of your live connections. Even if you know <code>netstat</code> this is a command you should get acquainted with because of its more powerful interface which requires fewer pipes to find the connection information you need and it is probably already installed on your favorite distribution.<p>In this post, we walk through a couple of examples, and then show a real-world production problem that can be diagnosed by effective use of <code>ss</code>.<p>To list TCP [<code>-t</code>] connections with destination port 9200 [<code>dst :9200</code>] and showing numeric port [<code>-n</code>] plus resolving DNS of addresses [<code>-r</code>] we use the following:<pre><code>ss -rnt dst :9200
</code></pre><p>The output of the above command might look something like this:<pre><code>Recv-Q Send-Q                         Local Address:Port                           Peer Address:Port
0      0                                  localhost:28655                             localhost:9200

# OR

Recv-Q Send-Q             Local Address:Port               Peer Address:Port
0      0         mysvc1-app3.dc1.exampleapp.com:44541      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33389      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:45740      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:53848      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33406      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33407      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33405      logs.dc1.exampleapp.com:9200
</code></pre><p>Now, this isn&rsquo;t very remarkable. Let&rsquo;s try to find TCP connections in <code>CLOSE_WAIT</code> state going to a specific destination address and port:<pre><code>$ /usr/sbin/ss -tarn state close-wait

Recv-Q Send-Q                              Local Address:Port                                Peer Address:Port
1      0         mysvc-app1.dc1.exampleapp.com:40701    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:29470    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:35594    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:39683    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:22715    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:23824    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:37015   mysvc-app10.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:28927    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:37298    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:42596   mysvc-app20.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:45345    mysvc-app1.dc1.exampleapp.com:50010
</code></pre><p>What about timers on sockets? Well, <code>ss</code> has what you want (list all [<code>-a</code>] TCP sockets [<code>-t</code>] with resoled DNS [<code>-r</code>], numeric ports [<code>-n</code>] that are in state of <code>TIME_WAIT</code> with timer information [<code>-o</code>]):<pre><code>$ ss -arnto state time-wait

Recv-Q Send-Q                              Local Address:Port                                Peer Address:Port
0      0         mysvc-app1.dc1.exampleapp.com:21665                   ldap.dc1.exampleapp.com:389    timer:(timewait,22sec,0)
0      0         mysvc-app1.dc1.exampleapp.com:45311   mysvc-app13.dc1.exampleapp.com:2191   timer:(timewait,24sec,0)
0      0         mysvc-app1.dc1.exampleapp.com:21606                   ldap.dc1.exampleapp.com:389    timer:(timewait,2.730ms,0)
0      0         mysvc-app1.dc1.exampleapp.com:40319    mysvc-app2.dc1.exampleapp.com:9092   timer:(timewait,4.949ms,0)
0      0         mysvc-app1.dc1.exampleapp.com:37364   mysvc-app12.dc1.exampleapp.com:2191   timer:(timewait,28sec,0)
0      0                                       localhost:39282                                  localhost:17123  timer:(timewait,54sec,0)

</code></pre><h2 id=look-ma-no-pipes>Look ma, no pipes!</h2><p>Looking for which process is listening on a port? Simple:<ul><li>using <code>-l</code> we limit ourselves to listening sockets<li>using <code>-t</code> we limit ourselves to TCP<li>using <code>-n</code> we make sure the port is shown as numeric not alias<li>using <code>-r</code> we resolve the hostnames<li>using <code>-p</code> we show processes using that socket</ul><p>Remember to get process information you usually need to sudo :)<pre><code>$ sudo ss -nltp state listening src :3030
Recv-Q Send-Q                                                           Local Address:Port                                                             Peer Address:Port
0      100                                                                  127.0.0.1:3030                                                                        *:*      users:((&quot;sensu-client&quot;,46889,17))
</code></pre><p>Note the users output is a 3-tuple with the process name as first entry, the PID as the second entry and <em>unknown</em> third entry (to me). Anyone know, it isn&rsquo;t explained in the man page.<h2 id=can-anybody-hear-me>Can Anybody Hear Me?</h2><p>Finally, let us walk through a production issue where <code>ss</code> helped us get to the root of the issue faster. Recently an alert was generated when one of our services in an environnt was no longer receiving Kafka messages. After taking the necessary steps to ensure that the Kafka cluster was up and functioning correctly, we went to the node that alerted. There we used <code>ss</code> to check for TCP connections to Kafka we saw no established TCP connections to Kafka, but we did see a connection in TCP state <code>'syn-sent'</code>[1]:<pre><code>$ sudo ss -antlp state syn-sent dst :9200
Recv-Q                        Send-Q                                               Local Address:Port                                                 Peer Address:Port
0                             1                                                        10.4.1.40:48928                                                   10.4.1.80:9200                         users:((&quot;java&quot;,pid=13657,fd=3))
</code></pre><p>The output above tells us some useful information, specifically that this host is trying to talk to Kafka, but it isn&rsquo;t able to connect to the broker. This information allowed us to investigate a possible networking problem, and in this specific example the DNS for Kafka had changed, and the application had cached the old entry.<p>1: <a href=https://en.wikipedia.org/wiki/TCP_half-open#Embryonic_connection>https://en.wikipedia.org/wiki/TCP_half-open#Embryonic_connection</a></article><div class=pagination></div></section><br><section class=disqus><div id=disqus_thread></div><script>(function(){if(window.location.hostname=="localhost")
return;var disqus_shortname='';var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view comments powered by <a href=http://disqus.com/?ref_noscript>Disqus</a>.</noscript></section></section></main><footer class="row middle-xs center-xs"><div class="col-xs-3 col-md-2"><a target=_blank rel=noopener href=https://github.com/referentiallabs>GitHub</a></div><div class="col-xs-3 col-md-2"><a target=_blank rel=noopener href=https://twitter.com/referentiallabs>Twitter</a></div><div class=col-xs-12>Copyright &copy; 2019 Referential Labs, LLC.</div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://referentiallabs.com/scripts/main.min.js></script></body></html>